<html>
<head>
    <meta charset="UTF-8">

    <script type="application/x-javascript" src="http://api.bridgeit.mobi/bridgeit/bridgeit.js"></script>

    <title>QR Scanner Demo</title>
    <style>
    body {
  background:url('https://dapply.mysynchrony.com/RP/qr') no-repeat;
  background-size:cover;
}
  </style>

   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"> </script> 
  <!-- <link rel="stylesheet" href="http://vdlesignapda02.cpu.syfbank.com:8000/bscss">
  <script src="http://vdlesignapda02.cpu.syfbank.com:8000/bsjs"></script> -->
</head>
<body>
<div style="height: 20%;width: 100%" >
   <img src="https://dapply.mysynchrony.com/RP/syflogo" height="100%" width="38%" float= "right">

<style>
    canvas {
        display: none;
    }
    hr {
        margin-top: -13px;
    }
    input[type="file"] {
        display: block;
        margin-bottom: 30px;
    }
    /*div {
        margin-bottom: 16px;
    }*/
</style>

</div>  
<div style="height: 70%;width: 40%;float: left">
<form action="/RP/camscan" method="POST">
<h3 style="color: white">Scan from WebCam</h3>
<input type="hidden" accept="image/*" id="capture" value="" capture="camera">
<div>

    <a id='scanBtn' type="button" 
   onclick="bridgeit.scan('scanBtn', 'onAfterCaptureScan');">Scan a Code</a>
<div id="scans">Result is here</div>

    <video muted autoplay playsinline id="qr-video"></video>
    <canvas id="debug-canvas"></canvas>
</div>
<div>
    <input type="checkbox" id="debug-checkbox">
    <span style="color: white">Show debug image</span>
</div>
<br>
<b style="color: white">Detected QR code: </b><br>
<br>
<!-- <span id="cam-qr-result">None</span> -->
<textarea rows="2" cols="22" id="cam-qr-result" name="tokenid1" placeholder="none" readonly ></textarea><br><br>
<input type="submit" class="btn btn-success" style="color: black" value="VERIFY"/> </form>

</div>
<div style="height: 70%;width: 40%;float: right" class="form-group">
<!-- <hr> -->
<div class="col-sm-6">
<form action="/RP/filescan"  method="POST">
<h2 style="color: #0B3B39">Scan from File:</h2><br>
<input type="file" id="file-selector" class="form-control"><br>
 <b style="color: #0B3B39">Detected QR code:</b> <br>
 <!-- <span id="file-qr-result" name="ta">None</span>  -->
<br>
 <textarea rows="2" cols="22" id="file-qr-result" name="tokenid2" placeholder="none" readonly></textarea><br><br>
 <input type="submit" class="btn btn-success"  style="color: black" value="VERIFY"/> </form>
</div>
    <script type="module">
    import QrScanner from "https://dapply.mysynchrony.com/RP/qr-scanner.min.js";
    const video = document.getElementById('qr-video');
    const debugCheckbox = document.getElementById('debug-checkbox');
    const debugCanvas = document.getElementById('debug-canvas');
    const debugCanvasContext = debugCanvas.getContext('2d');
    const camQrResult = document.getElementById('cam-qr-result');
    const fileSelector = document.getElementById('file-selector');
    var fileQrResult = document.getElementById('file-qr-result');


    function setResult(label, result) {
        label.textContent = result;
        label.style.color = 'teal';
        clearTimeout(label.highlightTimeout);
        label.highlightTimeout = setTimeout(() => label.style.color = 'inherit', 100);
    }

function onAfterCaptureScan(event)  {
    var text = event.value;
    document.getElementById("scans").innerHTML = text;
   // var row1 = document.createElement('div');
    //row1.setAttribute('class','row');
    //row1.innerHTML = text;
   // scans.insertBefore(row1, scans.firstChild);
}

    // ####### Web Cam Scanning #######

    const scanner = new QrScanner(video, result => setResult(camQrResult, result));
    scanner.start();


    // ####### File Scanning #######

    fileSelector.addEventListener('change', event => {
        const file = fileSelector.files[0];
        if (!file) {
            return;
        }
        QrScanner.scanImage(file)
            .then(result => setResult(fileQrResult, result))
            .catch(e => setResult(fileQrResult, e || 'No QR code found.'));
    });


    // ####### debug mode related code #######

    debugCheckbox.addEventListener('change', () => setDebugMode(debugCheckbox.checked));

    function setDebugMode(isDebug) {
        const worker = scanner._qrWorker;
        worker.postMessage({
            type: 'setDebug',
            data: isDebug
        });
        if (isDebug) {
            debugCanvas.style.display = 'block';
            worker.addEventListener('message', handleDebugImage);
        } else {
            debugCanvas.style.display = 'none';
            worker.removeEventListener('message', handleDebugImage);
        }
    }

    function handleDebugImage(event) {
        const type = event.data.type;
        if (type === 'debugImage') {
            const imageData = event.data.data;
            if (debugCanvas.width !== imageData.width || debugCanvas.height !== imageData.height) {
                debugCanvas.width = imageData.width;
                debugCanvas.height = imageData.height;
            }
            debugCanvasContext.putImageData(imageData, 0, 0);
        }
    }
</script>
</div>


</body>
</html>
